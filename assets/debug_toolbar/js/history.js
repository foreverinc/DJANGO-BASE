import{$$,ajaxForm,replaceToolbarState}from"./utils.js";const djDebug=document.getElementById("djDebug");function difference(e,t){const r=new Set(e);for(const e of t)r.delete(e);return r}function pluckData(e,t){const r=[];return e.forEach((function(e){r.push(e.dataset[t])})),r}function refreshHistory(){const e=djDebug.querySelector(".refreshHistory"),t=document.getElementById("djdtHistoryRequests"),r=new Set(pluckData(t.querySelectorAll("tr[data-store-id]"),"storeId"));ajaxForm(e).then((function(e){t.querySelectorAll("tr[data-store-id]").forEach((function(e){e.remove()})),e.requests.forEach((function(e){t.innerHTML=e.content+t.innerHTML}))})).then((function(){const e=new Set(pluckData(t.querySelectorAll("tr[data-store-id]"),"storeId")),o=difference(e,r),s=o.values().next().value;return{allIds:e,newIds:o,lastRequestId:s}})).then((function(e){e.newIds.forEach((function(e){t.querySelector(`tr[data-store-id="${e}"]`).classList.add("flash-new")})),setTimeout((()=>{t.querySelectorAll("tr[data-store-id]").forEach((e=>{e.classList.remove("flash-new")}))}),2e3)}))}function switchHistory(e){const t=djDebug.querySelector(".switchHistory[data-store-id='"+e+"']"),r=t.closest("tbody").querySelector(".djdt-highlighted");r&&r.classList.remove("djdt-highlighted"),t.closest("tr").classList.add("djdt-highlighted"),ajaxForm(t).then((function(t){if(0===Object.keys(t).length){document.getElementById("djdtHistoryRequests").querySelector('button[data-store-id="'+e+'"]').innerHTML="Switch [EXPIRED]"}replaceToolbarState(e,t)}))}$$.on(djDebug,"click",".switchHistory",(function(e){e.preventDefault(),switchHistory(this.dataset.storeId)})),$$.on(djDebug,"click",".refreshHistory",(function(e){e.preventDefault(),refreshHistory()}));